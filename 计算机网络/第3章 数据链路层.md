## 一、数据链路层概述
### 1、主要任务 
- 在物理层提供服务的基础上向网络层提供服务
- 加强物理层传输原始比特流的功能，将物理层提供的可能出错的物理连接改造为逻辑上无差错的数据链路，使之对网络层表现为一条无差错的链路
![image-20231118141821673](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118141821673.png)

### 2、为网络层提供服务
- **无确认的无连接服务**：
	- 源主机发送帧不需要先建立链路链接，目的主机收到帧时不需要发回确认
	- 数据传输的可靠性由高层负责
	- 适用于实时通信或误码率较低的通信信道 —— 以太网
- **有确认的无连接服务**：
	- 源主机不需建立，目的主机必须发回确认
	- 源主机在规定时间未收到确定信号，就重传丢失帧
	- 适用于误码率较高的通信信道 —— 无线通信
- **有确认的有连接服务**：
	- 三个阶段：建立链路、传输帧、释放链路
	- 目的主机对收到的每一个帧都要返回确认
	- 适用于对**可靠性，实时性**要求较高的场合

### 3、信道分类
- **点对点信道**：
	- 一对一
	- PPP 协议
- **广播信道**：
	- 一对多
	- 有限局域网使用 CSMA/CD 协议
	- 无线局域网使用 CSMA/CA 协议

### 4、三个重要问题
- **封装成帧和透明传输**：
	- 数据链路层给上层交付下来的协议数据单元 PDU 添加帧首部和帧尾部，这称为封装成帧
	- 如果能够采取措施，使得数据链路层对上层交付的 PDU 的内容没有任何限制，就好像数据链路层不存在一样，就称其为透明传输
- **差错检测**：
	- 帧在传输的过程中可能出现误码
	- 接收方根据发送方添加在帧尾部中的检错码，可以检测出帧是否出现了误码
- **可靠传输**：
	- 不可靠传输服务：收到有误码的帧，直接丢弃，其他什么也不做；未收到发送方发送的帧，也不进行任何处理
	- 可靠传输服务：实现发送方发送什么，接收方最终都能正确收到

### 5、相关概念
- **链路**：指从一个节点到相邻节点的一段物理线路（有线或无线），而**中间没有任何其他的交换节点**
![image-20231118142222986](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118142222986.png)

- **数据链路**：
	- 把实现控制数据传输的通信协议的硬件和软件加到链路上
	- 由网络适配器【网卡】和其相应软件驱动程序实现通信协议
	- **一般网卡包含物理层和数据链路层的功能**
![image-20231118142257703](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118142257703.png)

- **链路管理**：数据链路层的建立、维持和释放过程

- **帧**：数据链路层对等实体之间在水平方向进行逻辑通信的**协议数据单元 PDU**
![image-20231112103446745](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112103446745.png)

## 二、封装成帧和透明传输
### 1、封装成帧（组帧）
- 指数据链路层给上层交付下来的协议数据单元 PDU**添加帧首部和帧尾部**
- 组帧主要解决：**帧定界、帧同步、透明传输**等问题
	- 帧头和帧尾中包含有**重要的控制信息**
	![image-20231118142719311](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118142719311.png)
	![image-20231118142736883](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118142736883.png)
	- 帧头和帧尾的作用之一就是**帧定界**
	![image.png](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/20240707162944.png)
	![image.png](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/20240707163149.png)
- **注意**：
	1. 在网络中信息是**以帧为最小单位进行传输**的，接收端要正确地接收帧，必须要清楚该帧在一串比特流中从哪里开始到哪里结束
	2. 分组（即 IP 数据报）是包含在帧中的数据部分，不需要加尾部来定界
	3. 为了提高帧的传输效率，应当使**帧的数据载荷的长度尽可能地大于首部和尾部的长度**
	4. 并不是每一种数据链路层协议的帧都包含帧定界标志【以太网 V2 的 MAC 帧】
- **最大传送单元（MTU）**：
	- 每一种数据链路层协议都规定了帧的数据载荷的长度上限
	- 以太网的 MTU 为 1500 个字节
	![image.png](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/20240707163800.png)

- **组帧方法**：较常用的是零比特填充法和违规编程法
#### （1）字符计数法
- 在帧首部使用一个计数字段来记录该帧所含的字节数【包括计数字段所占用的 1 个字节】
- **缺点**：如果计数字段出错，就失去了帧定界划分的依据
![image.png](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/20240707170241.png)

#### （2）字节填充法
- 使用特定字节来定界一帧的开始与结束
	- SOH 表示帧的首部开始
	- EOT 表示帧的结束
- 在特殊字符前面填充一个转义字符 ESC 来区分
- 接收方收到数据会删除 ESC 然后得到原来的数据
![image.png](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/20240707170813.png)

#### （3）零比特填充法
- 允许数据帧包含任意个数的比特，使用 01111110 标志一帧的开始和结束
- 在数据中如果出现连续的 5 个 1，就插入一个 0
- 早期使用的 HDLC 协议采用这种方法
- 很容易用硬件实现，性能优于字符填充法
![image.png](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/20240707171504.png)

#### （4）违规编程法
- 在物理层进行比特编码时，通常采用违规编码法
- 局域网 IEEE 802 标注采用这种方法
- 不采用任何填充技术便能实现数据的透明传输
- 只适合于采用冗余编码的特殊编码环境


### 2、透明传输
- 数据链路层对上层交付下来的协议数据单元 PDU 没有任何限制，就好像数据链路层不存在一样 【**保证接收方接到的数据是完整的数据**】
- 面向字节的物理链路使用**字节填充**的方法
![image-20231118143645931](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118143645931.png)

- 面向比特的物理链路使用**比特填充**的方法
![image-20231118143716167](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118143716167.png)

## 三、差错检测
### 1、误码的相关概念
- **比特差错**：实际的通信链路都不是理想的，比特在传输过程中可能会产生差错
	- 比特 1 可能变成比特 0
	- 比特 0 可能变成比特 1
- **误码率 BER**：在一段时间内，传输错误的比特占所传输比特总数的比率
- 提高链路的信噪比，可以降低误码率
- 使用**差错检测码**(如 `Mac` 帧尾的 `FCS`) 来检测数据在传输过程中是否产生了比特差错，是数据链路层所要解决的重要问题之一
- 检测分类：
	- **检错码**：只能检测错误，不能纠正错误
	- **纠错码**：可以纠正错误，但是开销大

### 2、检错编码
- 检错编码都采用冗余编码技术，常用的检错编码有奇偶奇偶校验码和循环冗余校验码
#### （1）奇偶检验码
- **奇校验**：是在待发送的数据后面**添加 1 个校验位**，使得添加该校验位后的整个数据中**比特 1 的个数为奇数**
- **偶校验**：是在待发送的数据后面**添加 1 个校验位**，使得添加该校验位后的整个数据中**比特 1 的个数为偶数**

![image-20231118144436178](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118144436178.png)

![image-20231118144449748](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118144449748.png)
- **注意**：
	- 如果有奇数个位发生误码，则奇偶性发生变化，可以检查出误码
	- 如果有偶数个位发生误码，则奇偶性不发生变化，不能检查出误码 (漏检)
#### （2）循环冗余码 CRC
- 基本思想：
	- 收发双方约定好一个**生成多项式 G(x)**
	- 发送方基于待发送的数据和 G(x)，计算出冗余码【帧检测序列 FCS】，将其添加到待传输数据的后面一起传输
	- 接收方通过生成多项式 G(x)，计算收到的数据和冗余码是否产生了误码
- 发送方的 FCS 生成和接收方的 CRC 检验都是由硬件实现
+ CRC 有很好的检错能力，漏检率非常低
+ CRC 具有纠错功能，只是数据链路层仅使用了检错功能，检测到帧出错则直接丢弃
- **除法内的相减实际是做异或运算**
![image-20231112104000229](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112104000229.png)

![image-20231112104006839](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112104006839.png)

![image-20231112104015119](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112104015119.png)

![image-20231112104022454](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112104022454.png)

### 3、纠错编码（海明码）
- 实现原理：在有效信息位中加入几个校验码组成海明码，把海明码的每个二进制位分配到几个奇偶校验组中，当某一位出错后，就会引起有关的几个校验位的值发生变化
- 该方法不但可以发现错位，还能指出错位的位置
- 海明码可以纠正一位差错
- **纠错 d 位，需要码距 2d+1 的编码**
- **检错 d 位，需要码距 d+1 的编码**
![image.png](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/20240707175424.png)

## 四、流量控制与可靠传输机制
### 1、流量控制与滑动窗口机制
- **流量控制**：由接收方控制发送发的发送速率，使接收方有足够的缓冲空间来接收每个帧
- 数据链路层控制的是**相邻结点**之间的流量，而传输层控制的是**端到端**的流量
- 数据链路层的控制手段是**接收方收不下就不返回确认**，传输层的控制手段是接收方通过**确认报文段中的窗口值来调整发送方的窗口值**
#### （1）停止 - 等待流量控制基本原理
- 发送方每次只允许发送一个帧
- 接收方每接收一个帧都要反馈一个应答信号，表示可以接收下一帧
- 发送方收到应答信号后才能发送下一帧
- 若发送方没有收到接收方反馈的应答信号，则需要一直等待
- 发送方每发送完一个帧，就进入等待接收方确认信息的过程中，因而传输效率很低

#### （2）滑动窗口流量控制基本原理
- **发送窗口 $W_T$**：
	- 发送方维持一组连续的允许发送帧的序号
	- 表示在还未收到确认信息的情况下，发送方最多还能发送多少个帧和哪些帧
	- $W_T = 1$ ：发送方每收到一个按序确认的确认帧，就将发送窗口向前滑动一个位置
![image.png](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/20240708145341.png)
- **接收窗口 $W_R$**：
	- 接收方维持一组连续的允许接收帧的序号
	- 控制可以接收哪些帧和不可以接收哪些帧
	- $W_R = 1$： 接收方每收到一个序号落入窗口的数据帧，就允许将该帧收下，然后将接受窗口向前滑动一个位置，并发回确认
![image.png](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/20240708145416.png)

### 2、可靠传输机制
- **可靠传输**：发送方发送的数据都能被接收方正确的接收，通常采用超时和确认重传两种机制实现
	- **确认**：接收方每收到发送方发来的数据帧，都要向发送方发回一个确认帧，表示已正确地收到该数据帧
	- **超时重传**：发送方在发送一个数据帧后就启动一个计时器，若在规定时间内没有收到所发送数据帧的确认帧，则重发该数据帧，直到发送成功为止
- **传输差错**：
	- 出现在数据链路层上层：分组重复，分组失序，分组丢失
	- 出现在数据链路层及其下层：误码（比特差错）
- 一般情况下，**有线链路**的误码率比较低，为了减小开销，并**不要求数据链路层向上提供可靠传输服务**，即使出现了误码，可靠传输的问题由其上层处理
- **无线链路**易受干扰，误码率比较高，因此**要求数据链路层必须向上层提供可靠传输服务**
- **可靠传输服务并不仅局限于数据链路层**，其他各层均可选择实现可靠传输
![image-20231118152619734](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118152619734.png)
- **自动重传请求（ARQ）**：
	- 通过接收方请求发送方重传出错的数据帧来恢复出错的帧，是通信中用于处理信道差错的方法之一
	- 重传的请求是发送方自动进行的，而不是接收方请求发送方重传某个误码的数据分组
	- 在 ARQ 协议中，数据帧和确认帧都必须编号，以区分确认接收方是对哪个帧确认，以及哪些帧还未确认
	- 分类：
		1. 停止-等待 ARQ (SW)
		2. 后退 N 帧 ARQ (GBN)
		3. 选择重传 ARQ (SR)
![image-20231112105036035](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112105036035.png)

#### （1）停止-等待 ARQ 协议：SW / 单帧滑动窗口 
- 发送方发送数据 `DATA`，接收方接收时进行差错检测
- 如果没有出现误码，则**接收**信息并返回`ACK`确认分组给发送方，发送方收到 `ACK` 后，一次通信结束
- 如果出现误码，则**丢弃**信息并返回`NAK`拒绝分组给发送方，发送方收到 `NAK` 后，重传 `DATA`
![image-20231112104230883](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112104230883.png)

- **引入超时重传机制**：
	- 解决 `DATA` 中途丢失的问题
	- 发送方可在每发送完一个数据分组时就启动一个**超时计时器**
	- 若到了超时计时器所设置的**超时重传时间（RTO）**，但发送方仍未收到接收方的 ACK 或 NAK，就重传之前已发送过的数据分组
	- 在数据链路层点对点的往返时间好确认，重传时间好确认
	- 在运输层，由于端到端往返时间不确定，重传时间不好确认
![image-20231118153009395](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118153009395.png)

- **对数据帧编号**：
	- 避免**分组重复**的传输错误
	- 对于 SW 协议，每次发送一个数据分组就停止等待，只需一个比特来编号【0 / 1】
![image.png](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/20240708153024.png)

- **对确认帧编号**：
	- 避免**确认分组迟到**的情况【数据链路层一般不会出现】
![](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/20240708154012.png)

- **信道利用率**：
$$
U=T_D/T_D+RTT+T_A
$$
![image-20231112104346528](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112104346528.png)

![image-20231118153705266](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118153705266.png)
- 若出现超时重传，对于传送有用的数据信息来说，信道利用率还要降低
- 在往返时间 RTT 相对较大的情况下，为了提高信道利用率，收发双方不适合采用停止-等待协议，而可以选择使用回退 N 帧（GBN）协议或选择重传（SR）协议
##### 例题
![image-20231118154233007](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118154233007.png)

#### （2）回退 N 帧 ARQ 协议：GBN / 多帧滑动窗口 ###
- 回退 N 帧协议**采用流水线传输方式，并且利用发送窗口来限制发送方连续发送数据分组的数量**，这属于**连续 ARQ 协议**
- 接收窗口尺寸只能等于 `1`，因此**接收方只能按序接收正确到达的数据分组**
- 在使用流水线传输方式时，发送方**不能无限制地连续发送数据分组**，否则可能会导致网络中的路由器或接收方来不及处理这些数据分组，进而导致数据分组的丢失，这实际上是对网络资源的浪费
![image.png](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/20240708164533.png)
- **信道利用率**：假设连续 ARQ 协议的发送窗口为 n：
	- $nT_D<T_D+RTT+T_A$：即在一个发送周期内可以发送完 n 个分组
$$
U=nT_D/T_D+RTT+T_A
$$
	- $nT_D>=T_D+RTT+T_A$：即在一个发送周期内可以发不完（或刚好发完） n 个分组，只要不发生差错，发送方就可不间断地发送分组，信道利用率为 1
- **信道平均（实际）数据传输速率** = 
	- 信道利用率 * 信道带宽（最大数据传输速率）
	- 发送周期内发送的数据量 / 发送周期

##### 1）无差错情况
* 发送方将 0-4 依次连续发送，没有出现乱序和误码
* 接收方按顺序接收他们，即每接受一个，接收窗口就向前滑动一个位置，并返回确认分组
* 发送方每接收一个，发送窗口就向前滑动一个位置
* 发送方可以将确认收到的分组从缓存中删除了，而接收方将已接收的分组择机交付给上层处理
* GBN 协议允许接收方进行**累计确认**：
	* 连续收到多个正确的数据帧后，对最后一个数据帧发回确认信息
	*  `ACK n` 表示发送过来的分组 x<=n 的都收到了，下次期望收到 n+1 号帧
	* **优点**：即使确认分组丢失，发送方也可能不必重传，减小资源开销
	* **缺点**：不能及时反映出确认分组的信息
![image-20231112104538143](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112104538143.png)

![image-20231112104544672](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112104544672.png)

![image-20231112104553737](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112104553737.png)
##### 2）有差错情况
![image.png](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/20240708161601.png)

##### 3）窗口尺寸的限制
$$
帧序列号=n位时，发送窗口W_T<=2^n-1,接收窗口=1
$$
![image.png](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/20240708162057.png)

![image.png](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/20240708162114.png)
- 此时，**无法分辨新旧数据分组**
##### 4）总结
![image-20231118155600707](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118155600707.png)

##### 5）例题
![image-20231118155848852](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118155848852.png)

#### （3）选择重传 ARQ 协议：SR / 多帧滑动窗口
- 为了**只重传出现差错的分组**，接收方不能再采用累计确认，而需要**对每个正确收到的分组进行逐一确认**
- 接收方设置足够的**帧缓冲区**：
	- 暂存那些失序但正确到达且序号落在接收窗口内的数据帧
	- 数目等于接收窗口的大小
![image.png](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/20240708163203.png)

![image-20231118160427547](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118160427547.png)
##### 例题
![image-20231118160447094](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118160447094.png)


## 五、介质访问控制


## 六、局域网

## 七、广域网

## 八、数据链路层设备






## 点对点协议PPP

### PPP概述

- 广域网应用最广泛的**点对点数据链路层协议**
- 用于规定帧格式，使之成为各种主机、网桥和路由器之间简单连接的一种共同的解决方案
- PPP是使用串行线路通信的面向字节的协议

![image-20231112114440220](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112114440220.png)

**PPP链路的连接过程**

![image-20231112114501649](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112114501649.png)

### PPP帧格式

> 注意：因为PPP是点对点的，并不是总线形，所以不用CSMA/CD协议，自然就没有最短帧，所以数据部分是`0-1500B`，而不是`46-1500B`
>

![image-20231112114525637](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112114525637.png)

### PPP帧的透明传输

![image-20231118165502886](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118165502886.png)

#### 面向字节的异步链路使用字节填充来实现透明传输

发送方处理:

+ 将数据载荷中出现的每一个**0x7E**减去0x20（相当于异或0x20），然后在其前面插入**转义字符0x7D**，变成7D5E
+ 若数据载荷中原来就含有**0x7D**，则把每一个**0x7D**减去0x20，然后在其前面插入**转义字符0x7D**，于是转义字符7D在数据中最终会变成**7D5D**
+ 将数据载荷中出现的每一个**ASCII码控制字符**（即数值小于0x20的字符），加上0x20（相当于异或0x20，将其转换成非控制字符），然后在其前面**插入转义字符0x7D**

接收方处理：

- 只需要**反变换**即可恢复出原来的帧的数据部分

![](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118170205169.png)

#### 面向比特的同步链路使用零比特填充来实现透明传输

发送方处理：

- 对帧的数据载荷进行扫描（一般由硬件完成），每出现**5个连续的比特1**，则在**其后填充一个比特0**

接收方处理：

- 对帧的数据载荷进行扫描，每出现**5个连续的比特1**时，就把**其后的一个比特0删除**

![image-20231118170229537](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118170229537.png)

### PPP帧的差错检测

![image-20231118170503663](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118170503663.png)

### PPP协议的特点（对比广域网的特点）

* PPP协议**提供差错检测但是不提供纠错功能**，只保证无差错接收（CRC校验），它是不可靠的传输协议，因此也不使用序号和确认机制
* 仅支持点对点的链路通信，不支持多点线路（PPP属于广域网，这点就属于广域网和局域网的区别了）
* PPP只支持全双工链路
* PPP两端可以运行不同的网络层协议，但仍然可以使用同一个PPP进行通信
* PPP是面向字节的

## 共享式以太网

### 网络适配器

- 要将计算机连接到以太网，需要使用相应的**网络适配器**（Adapter），网络适配器一般简称为“**网卡**”
- 在计算机内部，**网卡与CPU**之间的通信，一般是通过计算机主板上的I/O总线以**并行传输**方式进行
- **网卡与外部以太网**（局域网）之间的通信，一般是通过传输媒体（同轴电缆、双绞线电缆、光纤）以**串行方式**进行的
- 网卡除要**实现物理层和数据链路层功能**，其另外一个重要功能就是要进行**并行传输和串行传输**的转换
- 为了使网卡正常工作，还必须要在计算机的操作系统中为网卡安装相应的设备**驱动程序**，负责驱动网卡发送和接收帧

![image-20231118214756420](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118214756420.png)

![image-20231118171539676](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118171539676.png)

### MAC地址

- 当多个主机连接在同一个广播信道上，要想实现两个主机之间的通信，则每个主机都必须有一个**唯一的标识**，即一个**数据链路层地址**
- 在每个主机发送的**帧的首部**中，都携带有发送主机（源主机）和接收主机（目的主机）的**数据链路层地址**。由于这类地址是用于**媒体接入控制**（Medium Access Control，MAC）的，因此被称为MAC地址

![image-20231118171903795](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118171903795.png)

- MAC地址一般被固化在网卡的电可擦可编程只读存储器EEPROM中，因此MAC地址也被称为**硬件地址**

- MAC地址有时也被称为**物理地址**

  > 注意：不要被物理地址中的“物理”二字误导，误认为物理地址属于网络体系结构中物理层的范畴，物理地址属于数据链路层范畴

  **例题**

  ![image-20231118172056275](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118172056275.png)

- 一般情况下，普通用户计算机中往往会包含两块网卡
  - 一块是用于接入有线局域网的以太网卡
  - 另一块是用于接入无线局域网的Wi-Fi网卡
- 每块网卡都有一个**全球唯一的MAC地址**

![](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118172402789.png)

![image-20231118172613497](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118172613497.png)

> 注意：
>
> 字节的发送顺序：第`1`字节->第`6`字节
>
> 字节内的比特发送顺序：`b0`->`b7`;
>
> 广播地址（本地多播）`FF-FF-FF-FF-FF-FF`：
>
> 即第1字节b0位=1，第1字节b1位=1，并且剩余`46`比特为`全1`

- 网卡从网络上每收到一个帧，就检查帧首部中的目的MAC地址，按以下情况处理
  - 如果目的MAC地址是广播地址（FF-FF-FF-FF-FF-FF），则接受该帧
  - 如果目的MAC地址与网卡上固化的全球单播MAC地址相同，则接受该帧
  - 如果目的MAC地址是网卡支持的多播地址，则接受该帧
  - 除上述情况外，丢弃该帧
- 网卡还可被设置为一种特殊的工作方式：**混杂方式**
  - 工作在混杂方式的网卡，只要收到共享媒体上传来的帧就会收下，而不管帧的目的MAC地址是什么

### 使用集线器的共享式以太网

在使用细同轴电缆的共享总线以太网之后，以太网发展出来了一种使用大规模集成电路来替代总线、并且可靠性非常高的设备，叫作集线器（Hub），站点连接到集线器的传输媒体也转而使用更便宜、更灵活的**双绞线电缆**。

**集线器的主要特点：**

- 使用集线器的以太网虽然**物理拓扑是星型**的，但在**逻辑上仍然是一个总线网**。总线上的各站点共享总线资源，**使用的还是CSMA/CD协议**
- 集线器**只工作在物理层**，它的每个接口仅简单地转发比特，并不进行碰撞检测。碰撞检测的任务由各站点中的网卡负责
- 集线器一般**都有少量的容错能力和网络管理功能**。例如，若网络中某个站点的网卡出现了故障而不停地发送帧，集线器可以检测到这个问题，在内部断开与出故障网卡的连线，使整个以太网能正常工作

### 在物理层扩展以太网

- 在早期广泛使用粗同轴电缆或细同轴电缆共享总线以太网时，为了提高网络的地理覆盖范围，常用的是工**作在物理层的转发器**

  - 每个站点到集线器的距离不能超过100m，因此两站点间的通信距离最大不能超过200m

  ![image-20231118210817822](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118210817822.png)

- 在10BASE-T星型以太网中，可使用**光纤**和一对**光纤调制解调器**来扩展站点与集线器之间的距离

  - 站点与集线器之间的距离扩展到1000以上

- 以太网集线器一般具有8~32个接口，如果要连接的站点数量超过了单个集线器能够提供的接口数量，就需要使用多个集线器，这样就可以连接成覆盖更大范围、连接更多站点的多级星型以太网，不过也带来了一些负面因素

  ![image-20231118211221228](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118211221228.png)

### 在数据链路层扩展以太网

#### 网桥(Bridge)

网桥（Bridge）工作在**数据链路层**（包含其下的物理层），因此网桥具备属于数据链路层相关能力

* 网桥可以**识别帧的结构**

* 网桥可以根据帧首部中的**目的MAC**地址和**网桥自身的帧转发表**来转发或丢弃所收到的帧

![image-20231112114614330](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112114614330.png)

#### 网桥的主要结构和基本工作原理

![image-20231112114644689](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112114644689.png)

* 转发表是网桥转发帧的依据，里面记录有个主机的MAC地址与自己各接口的对应关系
* 网桥的接口在向其连接的网段转发帧时，会执行相应的媒体接入控制协议。对于共享式以太网就是CSMA/CD协议

**网桥转发帧**

![image-20231112114652716](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112114652716.png)

**网桥丢弃帧**

![image-20231112114709055](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112114709055.png)

**注意网桥转发广播帧，是不查转发表的**

![image-20231112114733974](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112114733974.png)

#### 透明网桥的自学习和转发帧流程

- **透明网桥（Transparent Bridge）通过自学习算法建立转发表**

- 透明网桥中的**透明**，是指以太网中的各站点并不知道自己所发送的帧将会经过哪些网桥的转发，最终到达目的站点。也就是说，**以太网中的各网桥对于各站点而言是看不见的**
- 透明网桥的标准是IEEE 802.1D，它通过一种自学习算法**基于以太网中各站点间的相互通信**逐步建立起自己的转发表

1. 网桥收到帧后进行**登记（自学习）**，自学习的内容为**帧的源MAC地址**和进入网桥的**接口号**
2. 网桥根据帧的**目的MAC地址**和**网桥的转发表**对帧进行转发，包括以下三种情况:
   * **明确转发**：网桥知道应当从哪个接口转发帧
   * **盲目转发**：网桥不知道应当从哪个接口转发帧，只能将其通过除进入网桥的接口外的其他所有接口转发
   * **丢弃**：网桥知道不应该转发该帧，将其丢弃

注意：

* 如果网桥收到有误码的帧则直接丢弃
* 如果网桥收到一个无误码的**广播帧**，则**不用进行查找，而是直接转发**
* 转发表中的每条记录都有其**有效时间**，到期自动删除。这是因为**各站点的MAC地址与网桥接口的对应关系并不是永久性的**，例如某个站点更换了网卡，其MAC地址就会改变

![image-20231112114757412](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112114757412.png)

![image-20231112114803125](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112114803125.png)

![image-20231112114809001](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112114809001.png)

#### 透明网桥的生成树协议STP

- 为了提高以太网的可靠性，有时需要在两个以太网之间使用多个透明网桥来提供**冗余链路**，但是冗余链路会造成网络环路的问题

>  若网桥B1和B2的转发表中都没有待转发单播帧目的MAC地址的相关记录，则该**单播帧也会引起类似的情况**

![image-20231112114827654](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112114827654.png)

- 在增加冗余链路提高以太网可靠性的同时，却给网络引入了**环路**
- 网络中的**广播帧将在环路中永久兜圈**，造成广播帧充斥整个网络，网络资源被白白浪费，而网络中的主机之间无法正常通信

- **透明网桥使用生成树协议（Spanning Tree Protocol, STP），**`STP`可以在增加冗余链路来提高网络可靠性的同时又避免网络环路带来的各种问题

##### 生成树原理 #####

![image-20231112114839986](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112114839986.png)

+ 不论交换机之间采用怎样的物理连接，网桥之间通过**交互网桥协议单元（Bridge Protocol Data Unit, BPDU）找出原网络中拓扑的一个连通子集（即生成树）**，在这个子集里整个连通的网络中**不存在环路**
+ 最终生成树的逻辑拓扑**要确保连通整个网络**
+ **当首次连接交换机或网络物理拓扑发生变化时(有可能是人为改变或故障)，网桥(交换机)都将进行生成树重新计算**

## 交换式以太网

> - 网桥的**接口数量很少**，通常只有2~4个，一般只用来**连接不同的网段**
> - 仅使用交换机（而不使用集线器）的以太网就是交换式以太网
>
> ![image-20231118213732175](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118213732175.png)

### 交换机（Switching Hub） ###

- 本质上是一个**多接口的网桥**

+ 以太网交换机一般都**工作在全双工方式**。以太网交换机**具有并行性**
+ **交换机每个接口是一个独立的碰撞域**
+ **当交换机的接口与计算机或交换机相连时**，每一对相互通信的计算机都能像独占传输媒体那样，无碰撞的传输数据，这样就不需要使用`CSMA/CD`协议了，交换机通常工作在这种**全双工模式**下
+ **当交换机的接口连接的是集线器时**，该接口就只能使用`CSMA/CD`协议，并且只能工作在**半双工模式**
+ **交换机一般都具有多种速率的接口**，例如 10Mb/s、100Mb/s、1Gb/s甚至10Gb/s的接口，大部分接口支持多速率自适应

![image-20231112114923881](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112114923881.png)

#### 交换机自学习和转发帧流程（参考网桥）

![image-20231112114943180](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112114943180.png)

#### 交换机工作方式

1. 存储转发（一般情况）
2. 直通交换（为了较小交换机的转发时延）

> 采用**直通交换**的交换机，在接受帧的**同时**就立即按**帧的目的地址**决定该帧的转发接口，然后通过**其内部基于硬件的交叉矩阵**进行转发，而不必把整个帧先缓存后处理
>
> * 直通交换的**时延非常小**
> * 直通交换**不检查差错**就直接将帧转发出去，有可能会将一些无效帧转发给其他主机

#### 交换机端口类型 ####

1. Access
2. Trunk
3. Hybird（华为私有）

> 思科交换机没有Hybird端口

**交换机各端口的VID**

> 思科交换机上叫Native VLAN，即本征VLAN
>
> 华为交换机上叫Port VLAN ID，即端口VLAN ID，`PVID`
>
> **每个端口有且只有一个PVID**。默认情况下端口的`PVID`都为`1`(即端口属于`VLAN 1`)

**端口上接收时总希望能够打上标签，发送出去时候总希望能去除标签**

##### ①Access端口 #####

![image-20231112115012178](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112115012178.png)

+ `Access`端口**一般用于终端设备与交换机之间**

  注意：**交换机与路由器连接的接口**也需要使用`access`接口。这是因为路由器中的消息也不带`VLAN`标签，就像终端一样，保证路由器的数据能够进入交换机领域，数据由路由器进入交换机是会被打上默认标签，接着才按照交换机间`VLAN`的规则行走。**简单理解就是把路由器当作终端**

+ 交换机**初始端口类型是Access**

+ Access端口只能属于一个VLAN

+ `Access`**端口的PVID值与端口所属VLAN的ID相同**(默认为`1`)

+ `Access`端口接收方法

  + 一般**只接收"未打标签"的普通以太网MAC帧**。根据接收帧的端口`PVID`值**给帧"打标签"**，即插入`4`字节的`VLAN`标记字段，字段中的`VID`取值与端口`PVID`取值相等

+ `Access`端口发送处理方法

  + 若帧中的**VID与端口的PVID相等，则"去标签"并转发该帧；否则不转发**

**用Access端口实现VLAN**

<img src="https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112115036958.png" alt="image-20231112115036958" style="zoom: 67%;" />

<img src="https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112115043219.png" alt="image-20231112115043219" style="zoom:67%;" />

![image-20231112115052986](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112115052986.png)

![image-20231112115105862](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112115105862.png)

##### ②Trunk端口 #####

+ `Trunk`端口一般用于**交换机之间或交换机与路由器之间**的互连
+ `Trunk`端口可以属于多个VLAN
+ 用户可以设置`Trunk`端口的`PVID`值，默认情况下，`Trunk`端口`PVID`值为`1`
+ `Trunk`端口发送处理方法
  + 对**VID等于PVID的帧，"去标签，再转发"**
  + 对**VID不等于PVID的帧，直接转发**
+ `Trunk`端口接收处理方法
  + **接收"未打标签"的帧。根据接收帧的端口的PVID给帧"打标签"**，即插入`4`字节的`VLAN`标记字段，字段中的`VID`取值与端口的`PVID`取值相等
  + **直接接收"已打标签的帧"**

**用Trunk端口实现VLAN**

![image-20231112115125758](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112115125758.png)

![image-20231112115133773](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112115133773.png)

![image-20231112115142710](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112115142710.png)

##### ③Hybrid端口（华为私有） #####

![image-20231112115200250](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112115200250.png)

##### 总结

![image-20231112115208812](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112115208812.png)

###### 练习

![image-20231112115225772](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112115225772.png)

![image-20231112115235625](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112115235625.png)

![image-20231112115245258](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112115245258.png)

#### 例题

![image-20231112115445598](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112115445598.png)

![image-20231112115454402](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112115454402.png)

![image-20231112115500591](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112115500591.png)

![image-20231112115310168](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112115310168.png)

![image-20231112115317361](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112115317361.png)

![image-20231112115323080](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112115323080.png)

### 总结：共享式以太网与交互式以太网的对比（集线器和交互机的对比）

1. 单播帧

![image-20231112115335378](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112115335378.png)

2. 广播帧

- 尽管集线器和交换机对于广播帧的效果是相同的，但是它们的工作原理不同
  - 集线器只工作在物理层，它并不能识别帧首部中的目的MAC地址，因为这属于数据链路层的范畴，不管是单播帧还是广播帧，集线器仅仅将表示帧的信号从其他所有接口转发出去
  - 交换机工作在数据链路层，它可以识别帧的结构，从帧首部中提取出目的MAC地址，知道这是一个广播帧（虽然不查转发表）

![image-20231112115355033](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112115355033.png)

3. 多主机同时通信

![image-20231112115413874](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112115413874.png)

4. 使用集线器和交换机扩展共享式以太网的区别

- 集线器既扩大了广播域又扩大了碰撞域

- 交换机扩大了广播域，没有大碰撞域

![image-20231112115432824](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112115432824.png)

## 随机访问MAC协议（动态/多点接入）

### ALOHA协议

纯ALOHA比时隙ALOHA吞吐量更低，效率更低

#### 纯ALOHA协议

不监听信道，不按时间槽发送，随即重发，即**想发就发**

![image-20231112110006059](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112110006059.png)

#### 时隙ALOHA协议

把时间分为若干个相同的时间片，所有用户在时间片开始时刻同步接入网络信道，若发生冲突，则必须等待到下一个时间片开始时刻再发送。即控制想发就发的随意性

![image-20231112110024484](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112110024484.png)

### CSMA/CD协议（共享式以太网）

#### 基本原理

- **载波监听多址接入/碰撞检测**（Carrier Sense Mutiple Access Collision Detection)

- 多个主机连接到一根总线上，当信息同一时间传送相遇时就会发生碰撞
- **共享总线以太网**的一个重要问题就是**如何协调各主机的工作**，使信息**避免碰撞**
- 为了避免各站点争用总线的问题，共享总线以太网使用了一种专用协议**CSMA/CD**

![](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118173537076.png) 

> **`CSMA/CD`适用于总线型网络或者半双工网络环境**，全双工网络不需要CSMA/CD协议（收发双方可以同时发送和接收数据，不会冲突）

#### 帧间最小间隔

> `96`比特时间是指发送`96`比特所需要的时间，也称为**帧间最小间隔**
>
> 其作用是是接收方可以检测出一个帧的结束，同时也使得其他站点都能有机会平等竞争信道并发送帧

![image-20231112110214462](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112110214462.png)

> - 载波监听检测到总线空闲，但是**总线不一定空闲**
>
> - **不能完全避免碰撞**
> - 只能进行**半双工通信**

#### 争用期(碰撞窗口)

![](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118195058407.png)

![image-20231112110253739](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112110253739.png)

1. 为什么$\tau - \frac{\delta}{2}$时刻发送碰撞？

> 当D开始发送的时，A已经走了$\tau - \delta$时间，所以剩下路程所需要的时间是$\delta$，
>
> 又因为A和D发送速度是相同的，因此对于$\delta$时间的路程，每人只需要走$\dfrac{\delta}{2}$时间就会相遇，
>
> 即碰撞时刻=$\tau - \delta +\dfrac{\delta}{2}=\tau -\dfrac{\delta}{2}$
>
> 

2. 为什么$t=\tau$时，D检测到碰撞？

> 根据上边推论，D走了$\dfrac{\delta}{2}$的时间路程后就发送了碰撞，此时它开始返回，经过同样的时间可以回到D
>
> 检测到碰撞时间=$\dfrac{\delta}{2}+\dfrac{\delta}{2}=\delta$

3. 为什么$2\tau - \delta$时，A检测到碰撞？

> 与D检测到碰撞同理，A走了$\tau -\dfrac{\delta}{2}$时间，因此往回走也是这么多时间
>
> A检测到碰撞时间=$\tau -\dfrac{\delta}{2}+\tau -\dfrac{\delta}{2}=2\tau - \delta$

+ 主机最多经过$2\tau(即\delta→0)的时长$就可以检测到本次发送是否遭受了碰撞

+ 因此，以太网的端到端往返传播时延$2\tau$称为**争用期**(Contention)或**碰撞窗口期**(Collision Window)

+ 经过争用期这段时间还没有检测到碰撞，才能肯定这次发送不会发生碰撞

+ 每一个主机在自己发送帧之后的一小段时间内，存在着遭遇碰撞的可能性。这一小段时间是不确定的。它取决于另一个发送帧的主机到本主机的距离，但**不会超过总线的端到端往返传播时延，即一个争用期时间**

+ 显然，总线的长度越长**（端到端往返传播时延越大）**、站点数量越多，发生碰撞的可能性就越大****

+ **因此，共享式以太网不能连接太多的主机，使用的总线也不能太长**

![image-20231112111402734](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112111402734.png)

> 因此其总线长度不能超过5210m
>
> 但考虑到其他一些因素，如转发器所带来的时延，以及产生碰撞时继续发送32比特或48比特认为干扰信号所持续的时间等，
>
> $\tau$实际上要更小

#### 最小帧长（64B）

**为什么需要规定最小帧长？**

> 为了确保共享总线以太网上的每一个站点在发送完一个完整的帧之前，能够检测出是否产生了碰撞，**帧的发送时延就不能少于共享总线以太网端到端的往返时间**，即一个争用期$2\tau$
>
> 假设`A`向`D`发送帧，如果帧很短的话：在$2\tau$内就会将帧发送完毕，帧发送完毕后不会进行碰撞检测，而此时依然有发生碰撞的可能

![image-20231112111758854](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112111758854.png)

+ **以太网规定最小帧长为64字节**，即512比特(512比特即争用期)
  + 如果要发送的**数据非常少，那么必须加入一些填充字节**，使帧长不小于64字节
+ 以太网的**最小帧长保证了主机可在帧发送完成之前就检测到该帧的发送过程中是否遭遇了碰撞**
  + 如果在争用期没有检测到碰撞，那么后续发送的数据就一定不会发生碰撞
  + 如果在争用期检测到碰撞就立即中止发送，这时已经发送出去的数据一定小于64字节，因此凡长度小于64字节的帧都是由于**碰撞检测而异常中止的无效帧**
+ 一般来说，**帧的数据载荷的长度应远大于帧首部和尾部的总长度**，这样可以**提高帧的传输效率**

![image-20231118200700864](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118200700864.png)

#### 退避算法

- 在使用CSMA/CD协议的共享总线以太网中，正在发送帧的站点一边发送帧一边检测碰撞，当检测到碰撞时就立即停止发送，**退避一段随机时间**后再重新发送
- 共享总线以太网中的各站点采用**截断二进制指数退避**（Truncated Binary Exponential Backoff）算法来选择退避的随机时间

![image-20231118200953850](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118200953850.png)

- 如果连续多次发送碰撞，就表明可能有较多的站点参与竞争信道。但使用上述退避算法可**使重传需要推迟的平均时间随重传次数而增大**（即**动态退避**），因而**减小产生碰撞的概率**
- **当重传达16次仍不能成功时**，就表明同时打算发送帧的站点太多，以至于连续产生碰撞，此时应**放弃重传**并向高层报告

#### 极限信道利用率

![image-20231112112026047](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112112026047.png)

+ 各主机发送帧都不会产生碰撞

+ 总线一旦空闲就有某个主机立即发送帧

+ 每帧的发送时延为$T_0$，传播时延为$\tau$，占用信道的时间为$T_0+\tau$

$$
极限信道利用率S_{max}=\dfrac{T_0}{T_0+\tau}=\dfrac{1}{1+\dfrac{\tau}{T_0}}\\
$$

  为了令$S_{max}$尽量大，所以应该让$\dfrac{\tau}{T_0}$尽量， 即$\tau$尽量小(以太网端到端距离收到限制)或T_0尽量大(以太网帧尽量长)

### CSMA/CA协议（802.11无线局域网）

#### 使用CSMA/CA协议的原因

**在无线局域网中，不能使用碰撞检测CD，主要是因为隐蔽站问题**：

+ 由于无线信道的传输条件特殊，其信号强度的动态范围非常大，**无线网卡上接收到的信号强度往往会远远小于发送信号的强度**(可能差百万倍)。如果要在无线网卡上实现碰撞检测CD，对硬件的要求特别高
+ 即使能够在硬件上实现无线局域网的碰撞检测功能，但由于**无线电波传播的存在隐蔽站的问题**，即在无线通信中，并非所有的站点都能听见对方。而有线网络中信号会随着总线到达各个地方，不会出现隐蔽站

> 无线局域网的隐蔽站问题
>
> ![image-20231118202917032](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118202917032.png)

- 802.11无线局域网采用了另一种称为CSMA/CA的协议，也就是**载波监听多址接入/碰撞避免**
- CSMA/CA协议仍然采用CSMA/CD协议中的**CSMA**，以“先听后说”的方式来减少碰撞的发生，但是**将“碰撞检测CD”改为了“碰撞避免CA”**(并不能避免所有的碰撞，而是尽量减少碰撞发生的概率)

> 由于**不可能避免所有的碰撞，并且无线信道误码率较高**，802.11标准还**使用了数据链路层确认机制**(停止-等待协议)来保证数据被正确接收

由于无线信道的通信质量远不如有限信道，所以802.11无线局域网不适用累计确认重传的方式，而使用链路层确认/重传机制（ARQ），即单帧确认

+ `802.11`的`MAC`层标准定义了两种不同的媒体接入控制方式

  + **分布式协调功能DCF**。在`DCF`方式下，没有中心控制站点，每个站点使用`CSMA/CA`协议通过***争用信道来获取发送权***，这是`802.11`定义的默认方式
  + **点协调功能PCF。**`PCF`方式使用集中控制的接入算法(一般在***接入点AP实现集中控制***)，是`802.11`定义的可选方式，在实际中较少使用

#### 工作原理

![](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118204253669.png)

- **分布式协调功能DFC**：没有中心控制站点，每个站点使用CSMA/CA协议通过争用信道来获取发送权。DCF方式是802.11定义的默认方式（必须实现）

1. **帧间间隔IFS**

为了尽量避免碰撞，802.11标准规定，所有的**站点必须在持续检测到信道空闲一段指定时间后才能发送帧**，这段时间称为帧间间隔IFS

**帧间间隔的长短取决于该站点要发送的帧的类型**

+ **高优先级帧需要等待的时间较短**，因此可优先获得发送权
+ **低优先级帧需要等待的时间较长**，若某个站的低优先级帧还没来得及发送，而其他站的高优先级帧已发送到信道上，则信道变为忙态，因而低优先级帧就只能再推迟发送了。这样就减少了发送碰撞的机会。

**常用的两种帧间间隔如下**

+ **短帧间间隔SIFS $28\mu s$**

  最短的IFS，用来分隔开属于一次对话的各帧。**一个站点应当能够在这段时间内从发送方式切换到接收方式**。使用`SIFS`的帧类型有ACK帧、CTS帧、由过长的MAC帧分片后的数据帧、以及所有回答AP探询的帧和在PCF方式中接入点AP发送出的任何帧

+ **分布协调帧间间隔DIFS $128\mu s$**

  最长的IFS，**用来发送数据帧和管理帧**

2. **信道忙NAV(Network Allocation Vector)**

> 当某个站检测到正在信道中传送的帧首部中的"持续时间"字段时，就调整自己的网络分配向量(Network Allocation Vetor, NAV)
>
> NAV指出了**完成这次帧的传送且信道转入空闲状态所需的时间**

**①为什么源站检测到信道空闲后，还需要等待DIFS时间才将帧发送呢？**

> 因为其他站此时**可能有优先级更高的帧需要发送**，因此有`DIFS`时间进行缓冲，若这个时间内没有高优先级的帧要发送，则说明信道是真正的空闲

**②为什么目的站接收到帧后还需要等到SIFS时间才返回ACK确认帧呢？**

> `SIFS`是最短的帧间间隔，用来分割一次对话的各帧，在这个时间里由接收状态转变为发送状态

**③当其他站要发送数据，但是发现此时信道正忙时就会退避一段时间，等信道不忙后再进行操作，接着等待DIFS时间(与①同理)，但为什么等待了DIFS时间后还要退避一段随机时间呢？**

> 因为可能有多个站点在信道忙时都想发送帧，因此它们都会被搁置直至信道不忙，在`DIFS`时间后他们会同时发送，而实际上多个站点同时发送数据会碰撞。因此需要一个随机时间将他们进行错峰发送。

#### 退避算法

- 当某个站在发送帧时，很可能有多个站都在监听信道并等待发送帧，一旦信道空闲，这些站几乎同时发送帧而产生碰撞
- 所有要发送帧的站检测到信道从忙转为空闲后，都要执行退避算法。这样不仅可以减少发生碰撞的概率，还可避免某个站长时间占用无线信道

> 仅在这种情况下才不使用退避算法：检测到信道空闲，并且该数据帧不是成功发送完上一个数据帧之后立即连续发送的数据帧
>
> **除此之外，以下情况必须使用退避算法**
>
> + 在发送数据帧之前检测到***信道处于忙状态***时
> + 在每一次***重传一个数据帧***时
> + 在每一次***成功发送后要连续发送下一个帧时***(这是为了避免一个站点长时间占用通道)

**基本原理**

+ 在执行退避算法时，站点为退避计时器设置一个随机的退避时间

  + 当退避计时器的时间减小到`0`，就开始发送数据
  + 当退避计时器的时间还未减小到`0`时信道又转变为忙状态，这时就**冻结退避计时器的数值，重新等待信道变为空闲**，再经过`DIFS`后，继续启动退避计时器

+ 在进行第`i`次退避时，退避时间在时隙编号$\{0,1,..,2^{i+1}-1\}$中随机选择一个，然后乘以基本退避时间(也就是一个时隙的长度)就可以得到随机的退避时间。这样做时为了使不同站点选择相同退避时间的概率减少

  当时隙编号达到`255`时(对应第`6`次退避)就不再增加了.

![image-20231112112907219](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112112907219.png)

#### 处理隐蔽站问题：信道预约

802.11标准允许要发送数据的站点对信道进行预约

1. 源站在发送数据帧之前先发送一个短的控制帧，即`请求发送RTS（Requst to send）控制帧`,`RTS`能被范围内所有的站点都听到

   > `RTS帧`包括源地址、目的地址以及这次通信(包括相应的确认帧)所需的持续时间

2. 若信道空闲，则目的站就发送一个响应控制帧，即`允许发送CTS(Clear to send)控制帧`，它也包括这次通信所需的持续时间（从RTS帧中将此持续时间复制到CTS帧中）

3. 源站收到`CTS`帧后，在CTS帧指明的时间内将抑制发送

   > CTS帧有两个目的
   >
   > - 给源站明确的发送许可
   >
   > - 指明其他站点在预约期内不要发送

   + **如果RTS帧发送碰撞，源站就收不到CTS帧，需执行退避算法重传RTS帧**
   + **由于RTS帧和CTS帧很短，发生碰撞的概率、碰撞产生的开销及本身的开销都很小**。而对于一般的数据帧，其发送时延往往大于传播时延(因为是局域网)，碰撞的概率很大，且一旦发生碰撞而导致数据帧重发就会浪费很多时间，因此用很小的代价对信道进行预约往往是值得的。`802.11`标准规定了3种情况供用户选择
     + 使用`RTS`帧和`CTS`帧
     + 不使用`RTS`帧和`CTS`帧
     + 只有当数据帧的长度超过某一数值时才使用`RTS`帧和`CTS`帧

![image-20231112112230281](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112112230281.png)

**虚拟载波监听**

> 除`RTS`帧和`CTS`帧会携带通信需要持续的时间，**数据帧也能携带通信需要持续的时间**，这称为`802.11`的虚拟载波监听机制

+ 由于利用虚拟载波监听机制，**站点只要监听到RTS帧、CTS帧或数据帧中的任何一个，就能知道信道被占用的持续时间**，而不需要真正监听到信道上的信号，因此虚拟载波监听机制能减少隐蔽站带来的碰撞问题
+ 如下图，`A`与`C`虽然互相覆盖不到，但是**C可收到B发出的关于A的CTS帧，从而得知A需要占用信道的时间**。在这段时间里，`C`不发送数据，从而解决隐蔽站带来的碰撞问题

![image-20231112112252706](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112112252706.png)

#### 总结：CSMA/CD和CSMA/CA区别

- CSMA/CD 可以检测冲突，但无法避免；CSMA/CA 发送数据的同时不能检测冲突，本结点处没有冲突并不意味着在接收结点处就没有冲突，只能尽量避免。
- 传输介质不同：CSMA/CD 用于总线形以太网，CSMACA 用于无线局域网 802.11a/b/g/n等
- 检测方式不同：CSMA/CD 通过电缆中的电压变化来检测；而 CSMA/CA 采用能量检测、载波检测和能量载波混合检测三种检测信道空闲的方式。

总结：CSMA/CA 协议的基本思想是在发送数据时先广播告知其他结点，让其他结点在某时间内不要发送数据，以免出现碰撞。CSMA/CD 协议的基本思想是发送前监听，边发送边监听一旦出现碰撞马上停止发送。

### 轮询访问MAC协议：令牌传递协议（动态）

#### 轮询协议

在轮询访问中，用户不能随机地发送信息，而要通过一个集中控制的监控站，以循环方式轮询每个结点，再决定信道的分配。当某结点使用信道时，其他结点都不能使用信道

**问题**

* 轮询开销
* 等待延迟
* 单点故障（主结点故障）

#### 令牌传递协议

典型的轮询访问介质访问控制协议是令牌传递协议，它主要用在令牌环局域网中。在令牌传递协议中，一个令牌（Token）沿着环形总线在各结点计算机间依次传递

令牌是一个特殊的 MAC 控制帧，它本身并不包含信息，仅控制信道的使用，确保**同一时刻只有一个站点独占信道**

当环上的站点希望传送帧时，必须等待令牌。一旦收到令牌，站点便可启动发送帧。帧中包括目的站点地址，以标识哪个站点应接收此帧。站点只有取得令牌后才能发送数据帧，因此令牌环网不会发生碰撞。站点在发送完一帧后，应释放令牌，以便让其他站使用。

**由于令牌在网环上是按顺序依次传递的，因此对所有入网计算机而言，访问权是公平的**

当计算机都不需要发送数据时，令牌就在环形网上游荡，而需要发送数据的计算机只有在拿到该令牌后才能发送数据帧，因此不会发生冲突（令牌只有一个）

> 令牌在设备间的**传递通路逻辑上必须是一个环**

**令牌环网过程**

令牌传递到有数据发送的站点时，就修改该令牌中的一个标志位，并且附上要发送的数据，然后转发这个数据帧

**应用**

轮询访问控制非常适用于负载很高的广播信道





### 例题

![image-20231112113157377](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112113157377.png)

![image-20231112113205342](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112113205342.png)

![image-20231112113217266](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112113217266.png)



## 局域网LAN

局域网（LAN Local Area Network）是指在一个较小的地理范围（如一个学校），将计算机、外部设备、数据库等通过双绞线等介质连接起来

> 双绞线为局域网的主流传输介质

### 局域网实现分类

* 以太网(Ethernet，最广泛，IEEE 802.3)

  逻辑拓扑是总线型，物理拓扑是星型

* 令牌环（Token Ring, IEEE 802.5）

  逻辑拓扑是环形，物理拓扑是星型

* FDDI（光纤分布数字接口，IEEE 802.8）

  逻辑拓扑是环形，物理拓扑是双环

* ATM网

  较新型的单元交换技术，使用53字节固定长度的单元进行交换

* 无线局域网WLAN，IEEE 802.11

### 局域网的主流实现：以太网`Ethernet`，IEEE 802.3标准

以太网Ehernet是由Xerox公司创建并由Xerox、Intel、和DEC联合开发的**基带总线局域网规范**，是局域网最通用的通信协议标准。

以太网使用CSMA/CD技术对总线进行访问控制

> 严格来说，以太网应是符合DIX Ethernet V2标准的局域网，但实际上DIX Ethernet V2和IEEE802.3 基本相同，我们习惯上把以太网称作IEEE 802.3局域网

**以太网提供无连接、不可靠的服务**

> 以太网只实现无差错接收，不实现可靠传输

#### 以太网传输介质、网卡

以太网常用的传输介质有四种：粗缆、细缆、双绞线、光纤

| 参数           | 10BASE5              | 10BASE2              | 10BASE-T     | 10BASE-FL       |
| -------------- | -------------------- | -------------------- | ------------ | --------------- |
| **传输媒体**   | 基带同轴电缆（粗缆） | 基带同轴电缆（细缆） | 非屏蔽双绞线 | 光纤对（850nm） |
| **编码**       | 曼彻斯特编码         | 曼彻斯特编码         | 曼彻斯特编码 | 曼彻斯特编码    |
| **拓扑结构**   | 总线型               | 总线型               | 星型         | 点对点          |
| **最大段长**   | 500m                 | 185m                 | 100m         | 2000m           |
| **最多结点数** | 100                  | 30                   | 2            | 2               |

> 10BASE-T非屏蔽双绞线以太网拓扑结构为星型网，中心为集线器，但使用集线器的以太网在逻辑上仍是一个总线型网，属于一个冲突域
>
> ![image-20231112113506252](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112113506252.png)

**网卡NIC(网络适配器)**



#### MAC地址



#### MAC帧(以太网V2)

以太网MAC帧格式有两种标准

1. DIX Ethernet V2 标准（以太网V2，流行）
2. IEEE 802.3 标准

> 这两个差不多，仅仅“类型”字段有差别

- 以太网的MAC帧的长度为：`64-1518`字节（最小帧长到最大帧长），以太网V2的数据链路层将封装好的MAC帧交付给物理层进行发送，物理层在发送帧之前还要在其前面添加`8`字节的前导码。

- 接收方可能收到的无效MAC帧包括以下几种
  - MAC帧的长度不是整数个字节
  - 通过MAC帧的FCS字段的值检测出帧有误码
  - MAC帧的长度不在64~1518字节之间

如果接收方收到无效的MAC帧时，就简单将其丢弃（以太网的数据链路层没有重传机制，提供的是无连接、不可靠服务）

![image-20231112113812081](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112113812081.png)

![image-20231112113824286](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112113824286.png)

* 目的地址和源地址：用来填入帧的**目的MAC地址**和**源MAC地址**

* 类型字段：指明数据载荷中的内容是由上一层的哪个协议封装的，以便将收到的MAC帧格式的数据载荷上交给上一层的这个协议。

![image-20231112113839832](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112113839832.png)

* 帧检验序列FCS：由循环冗余校验（CRC）生成，接收方的网卡通过FCS的内容就可检测出帧在传输过程中是否产生了误码

#### 高速以太网

速率达到或超过`100Mb/s`的以太网叫高速以太网

* 100BASE-T以太网

  支持全双工（全双工模式不需要CSMA/CD协议）

* 吉比特以太网（千兆以太网）

  1Gb/s

* 10吉比特以太网

以太网从10Mb/s到10Gb/s的发展证明了以太网是可拓展的（10Mb/s到10Gb/s）、灵活的（多种传输媒体，全/半双工、共享/交换），易于安装，稳健性好

### WLAN，IEEE 802.11无线局域网

**WLAN（Wireless Local Area Network）**IEEE于1997年制定出了无线局域网的协议标准802.11，802.11无线局域网是目前应用最广泛的无线局域网之一，人们更多地将其简称为WIFI(Wireless Fidelity, 无线保真度)

**802.11无线局域网可分为以下两类：**

1. 有固定基础设施的

2. 无固定基础设施的

   > 固定基础设施是指预先建立的、能够覆盖一定地理范围的、多个固定的通信基站
   >
   > 802.11无线局域网使用最多的是它的固定基础设施的组网方式

#### 有固定基础设施的

`接入点AP`：中心基站

> 网络管理员需要为AP分配一个最大32字节的服务集标识符（Service Set Identifier，`SSID`）和一个无线通信信道，SSID实际上就是使用该AP的802.11无线局域网的名字
>
> 本BSS内各站点之间的通信以及与本BSS外的站点之间的通信，都必须经过白BSS内的AP进行转发

`基本服务集BSS`：最小构件

> 在一个BSS中，包含有一个AP和若干个移动站

`基本服务区BSA`：一个BSS所覆盖的地理范围(无线局域网直径<100m)

![image-20231112113917696](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112113917696.png)

**拓展的服务集**

- 一个基本服务集可以是孤立的，也可以通过AP连接到一个分配系统DS，然后再连接到另一个服务集，就构成了一个拓展的服务集ESS

- 分配系统的作用就是使拓展的服务集对上层的表现就像一个基本服务集一样

- ESS还可以通过Portal（门户）设备为无线用户提供到有线连接的以太网的接入

  **门户的作用相当于一个网桥**

![image-20231112113940932](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112113940932.png)

#### 无固定基础设施（自组织网络）

- 自组织网络没有AP，而是由一些平等状态的移动站相互通信组成的临时网络

- 各结点地位平等，中间节点都为转发结点，因此都具有路由器的功能

![image-20231112113955143](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112113955143.png)

#### 802.11无线局域网的物理层

![image-20231112114014196](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112114014196.png)

#### 802.11无线局域网的MAC帧

**帧分三种**:

1. **数据帧:**

   用于在站点间的传输

2. **控制帧:**

   * 通常与数据帧搭配使用
   * 负责区域的清空,虚拟载波监听的维护以及信道的接入,并于收到数据帧时予以确认
   * ACK帧,RTS帧以及CTS帧等都属于控制帧

3. **管理帧:**

   * 用于加入或退出无线网络,以及处理AP之间连接的转移事宜
   * 信标帧,关联请求帧以及身份认证帧等都属于管理帧

**802.11无线局域网的MAC帧格式**

MAC首部，`30`字节数据部分，`0-2312`字节（比以太网V2长很多）

![image-20231112114029033](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112114029033.png)

- 持续期：用于实现CSMA/CA的虚拟载波监听和信道预约机制，在数据帧、RTS帧和CTS帧中用该字段指出将要持续占用信道的时长
- 序号控制：用来实现802.11的可靠传输，对数据帧进行编号
- 帧控制，地址1、2、3、4：取决于帧控制字段中的“去往DS”（到分配系统）和“来自DS”（分配系统）这两个字段的值

> 地址1是直接接收数据帧的结点地址，地址2是实际发送数据帧的结点地址
>
> **注意，接收地址与目的地址不是一个概念，因为要通过AP中转**

![image-20231112114050129](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112114050129.png)

**发送数据帧的情况:**

A->B

![image-20231112114102074](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112114102074.png)

A->R（路由器接口）

802.11MAC帧需要通过AP转为802.3帧

![image-20231112114113363](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112114113363.png)

#### 例题

![image-20231112114139501](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112114139501.png)

### VLAN，虚拟局域网

**虚拟局域网VLAN（Virtual Local Area Network）**：一种将局域网内的设备划分成**与物理位置无关的逻辑组**的技术，这些逻辑组具有某些共同的需求，每个`VLAN`就是一个独立的广播域

![image-20231112114152975](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112114152975.png)

**为什么需要VLAN？**

随着交换式以太网规模的扩大，广播域相应扩大，**而巨大的广播域会带来很多弊端**（广播风暴）

> 广播风暴：如果数台交换机连接了数台主机，当主机`A`要向主机`B`发送数据帧，此时各交换机的`MAC`表均为空，因此帧每到一个交换机就会进行泛洪，由于网络巨大，因此泛洪的范围也巨大
>
> ![image-20231112114204848](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231112114204848.png)

**那么巨大的广播域应该避免，如何分割分割广播域？**

1. 使用**路由器**（成本很高，全部使用路由器隔离广播域是不现实的）

   ![](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118215908627.png)

> 路由器工作在网络体系结构的第三层，网络层。由于路由器默认情况下不对广播数据包进行转发，因此路由器很自然的就可以隔离广播域

2. VLAN

#### VLAN实现机制 ####

**虚拟局域网VLAN是基于交换机实现的**，要求实现两个功能：

1. 处理带有VLAN标记的帧，即`IEEE 802.1 Q帧`
2. 交换机的各个端口可以支持**不同的接口类型**（不同类型的端口对帧的处理方式有所不同）

#### IEEE 802.1 Q帧（也叫Dot One Q 帧）

对以太网的MAC帧格式进行了扩展，**插入了4字节的VLAN标签**，用来标明计算机属于哪个虚拟局域网。

VLAN的首部增加到了4字节，所以最大帧长从`1518`变为了`1522`

![](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/image-20231118220257281.png)

**VLAN标签**

![](https://qingwu-oss.oss-cn-heyuan.aliyuncs.com/lian/img/408.oss-cn-hangzhou.aliyuncs.com202305100847412.png)

+ **标签协议标识符TPID：**长度为16比特，其值固定为0x8100，表示该帧是IEEE 802.1Q帧

+ **优先级PRI：**长度为3比特，取值范围是0~7，值越大优先级越高。当网络阻塞时，设备优先发送优先级高的802.1Q帧

+ **规范格式指示符CFI：**长度为1比特，取值为0表示MAC地址以规范格式封装，取值为1表示MAC地址以非规范格式封装。对于以太网，CFI的取值为0

+ **虚拟局域网标识符VID：**唯一地标志了以太网帧属于哪一个VLAN长度为12比特，取值范围是0~4095，其中0和4095保留不使用

  + `0`和`4095`都不用来表示`VLAN`，因此用于表示`VLAN`的**VID的有效范围是1~4094**

    > 注意：
    >
    > 插入VID后，FCS字段必须重新计算

+ **802.1Q帧时是交换机来处理的，而不是用户主机来处理的**

  用户不知道自己的VID值，但交换机必须知道，这样就实现了分割广播域

  + 当交换机**收到普通的以太网帧时**，会将其插入`4`字节的VLAN标记转变为`802.1Q帧`，简称**"打标签"**
  + 当交换机**转发802.1Q帧时**，可能会删除其`4`字节`VLAN`标记转变为普通以太网帧，简称**"去标签"**

## 广域网

- 广域网通常是指覆盖苑围很广（远超一个城市的范围）的长距离网络
- 广域网是因特网的核心部分

- 连接广域网各结点交换机的链路都是高速链路。它可以是长达几千千米的光缆线路，也可以是长达几万千米的点对点卫星链路。因此广域网首要问题是保证通信容量足够大

- 广域网不等于互联网，互联网可以连接不同类型的网络（既可以连接局域网，又可以连广域网，互联网用路由器连接）。

- 广域网通常用一些结点交换机（注意不是路由器）连接

> 结点交换机和路由器都用来转发分组，它们的工作原理也类似。
>
> 区别是结点交换机在**单个网络**中转发分组，而路由器在**多个网络构成的互联网**中转发

从层次上看，局域网主使用的协议要在数据链路层，而广域网使用的协议主要在网络层

### 总结：广域网和局域网区别

|                 | 广域网                     | 局域网             |
| --------------- | -------------------------- | ------------------ |
| 覆盖范围        | 跨区域                     |                    |
| 连接方式        | 点到点                     | 多点接入           |
| OSI参考模型层次 | 物理层，数据链路层，网络层 | 物理层，数据链路层 |

## 灵魂拷问

### 链路和数据链路有什么区别?

### 对于选择重传协议。若有n比特进行编号，则接受窗口最大值为2^(n-1)

### 数据链路层使用PPP协议或者CSMA/CD协议时，既然不保证可靠传输，为什么要对所传输的帧进行差错检验？

### 为什么PPP协议不适用帧的编号和确认机制来实现可靠传输？